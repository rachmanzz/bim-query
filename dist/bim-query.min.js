"use strict";var axios=require("axios"),bim=require("bim"),bimquery=function(){this.query={},this.baseurl=null,this.auth=null};bimquery.prototype.init=bimquery;var opt=[{q:"<",al:"s"},{q:"<=",al:"sq"},{q:">",al:"b"},{q:">=",al:"bq"},{q:"!=",al:"not"}],filterOpt=function(i){var e=opt.filter(function(e){return e.q===i});return 0===bim.size(e)?null:e[0].al};bimquery.prototype.where=function(e,i,r){if(bim.isArray(e))for(var t=e.length,s=0;s<t;s++){var u=e[s];if(bim.isArray(u)){var h=bim.size(u);2<=h&&u<=3&&bim.iString(u[0])&&(3===h?this.where(u[0],u[1],u[2]):this.where(u[0],u[1]))}}else if(bim.iString(e)&&bim.isNotUndef(i))if(bim.isNotUndef(this.query.where))if(bim.isArray(this.query.where))bim.isNumber(i)?this.query.where.push(bim.isUndef(r)?e+"|!"+i:e+"|!"+r+"|"+filterOpt(i)):this.query.where.push(bim.isUndef(r)?e+"|"+i:e+"|"+r+"|"+filterOpt(i));else{var b=[];b.push(this.query.where),this.query.where=b,bim.isNumber(i)?this.query.where.push(bim.isUndef(r)?e+"|!"+i:e+"|!"+r+"|"+filterOpt(i)):this.query.where.push(bim.isUndef(r)?e+"|"+i:e+"|"+r+"|"+filterOpt(i))}else bim.isNumber(i)?this.query.where=bim.isUndef(r)?e+"|!"+i:e+"|!"+r+"|"+filterOpt(i):this.query.where=bim.isUndef(r)?e+"|"+i:e+"|"+r+"|"+filterOpt(i);return this},bimquery.prototype.orwhere=function(e,i,r){if(bim.isArray(e))for(var t=e.length,s=0;s<t;s++){var u=e[s];if(bim.isArray(u)){var h=bim.size(u);2<=h&&u<=3&&bim.iString(u[0])&&(3===h?this.where(u[0],u[1],u[2]):this.where(u[0],u[1]))}}else if(bim.iString(e)&&bim.isNotUndef(i))if(bim.isNotUndef(this.query.orwhere))if(bim.isArray(this.query.orwhere))bim.isNumber(i)?this.query.orwhere.push(bim.isUndef(r)?e+"|!"+i:e+"|!"+r+"|"+filterOpt(i)):this.query.orwhere.push(bim.isUndef(r)?e+"|"+i:e+"|"+r+"|"+filterOpt(i));else{var b=[];b.push(this.query.orwhere),this.query.orwhere=b,bim.isNumber(i)?this.query.orwhere.push(bim.isUndef(r)?e+"|!"+i:e+"|!"+r+"|"+filterOpt(i)):this.query.orwhere.push(bim.isUndef(r)?e+"|"+i:e+"|"+r+"|"+filterOpt(i))}else bim.isNumber(i)?this.query.orwhere=bim.isUndef(r)?e+"|!"+i:e+"|!"+r+"|"+filterOpt(i):this.query.orwhere=bim.isUndef(r)?e+"|"+i:e+"|"+r+"|"+filterOpt(i);return this},bimquery.prototype.between=function(e,i,r){if(bim.isArray(e))for(var t=e.length,s=0;s<t;s++){var u=e[s];bim.isArray(u)&&3===bim.size(u)&&this.between(u[0],u[1],u[2])}else if(bim.iString(e)&&bim.isNumber(i)&&bim.isNumber(r))if(bim.isNotUndef(this.query.between))if(bim.isArray(this.query.between))this.query.between.push(e+"|"+i+"-"+r);else{var h=[];h.push(this.query.between),this.query.between=h,this.query.between.push(e+"|"+i+"-"+r)}else this.query.between=e+"|"+i+"-"+r;return this},bimquery.prototype.groupby=function(e){return this.query.groupby=e,this},bimquery.prototype.offset=function(e){return this.query.offset=e,this},bimquery.prototype.limit=function(e){return this.query.limit=e,this},bimquery.prototype.orderby=function(e,i){if(bim.isNotUndef(this.query.orderby))if(bim.isArray(this.query.orderby))this.query.orderby.push(e+"|"+i);else{var r=[];r.push(this.query.orderby),this.query.orderby=r,this.query.orderby.push(e+"|"+i)}else this.query.orderby=e+"|"+i;return this},bimquery.prototype.with=function(e){if(bim.isNotUndef(e))if(bim.isArray(this.query.with))this.query.with.push(e);else{var i=[];i.push(this.query.with),this.query.with=i,this.query.with.push(e)}else this.query.with=e;return this},bimquery.prototype.paginate=function(e,i){return bim.isNotUndef(i)?this.query.paginate=e+"|"+i:this.query.paginate=e,this},bimquery.prototype.page=function(e,i){return bim.isNotUndef(i)?this.query.paginate=e+"|"+i:this.query.paginate=e,this},bimquery.prototype.first=function(){return this.query.first=!0,this},bimquery.prototype.generate=function(){return this.query},bimquery.prototype.setUrl=function(e){return this.baseurl=e,this},bimquery.prototype.release=function(){return this.query={},this},bimquery.prototype.auth=function(e){return this.auth="Bearer "+e,this},bimquery.prototype.get=function(e,i){var r=null!==this.baseurl?this.baseurl+e:e,t=bim.isObj(i)?i:{};return null!==this.auth&&(t.headers={Authorization:this.auth}),bim.isObj(t.params)&&(t.params=bim.merge(t.params,this.query)),axios.get(r,t)},bimquery.prototype.post=function(e,i,r){var t=null!==this.baseurl?this.baseurl+e:e,s=bim.isObj(r)?r:{};return null!==this.auth&&(s.headers={Authorization:this.auth}),bim.isObj(s.params)&&(s.params=bim.merge(s.params,this.query)),axios.post(t,bim.isNotUndef(i)?i:{},s)},bimquery.prototype.put=function(e,i,r){var t=null!==this.baseurl?this.baseurl+e:e,s=bim.isObj(r)?r:{};return null!==this.auth&&(s.headers={Authorization:this.auth}),bim.isObj(s.params)&&(s.params=bim.merge(s.params,this.query)),axios.put(t,bim.isNotUndef(i)?i:{},s)},bimquery.prototype.delete=function(e,i){var r=null!==this.baseurl?this.baseurl+e:e,t=bim.isObj(i)?i:{};return null!==this.auth&&(t.headers={Authorization:this.auth}),bim.isObj(t.params)&&(t.params=bim.merge(t.params,this.query)),axios.delete(r,t)},module.exports=new bimquery;
